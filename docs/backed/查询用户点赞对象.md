# 逻辑

authorize后，直接调 /thumb/user接口，post就是查这个用户所有点过赞的帖子，你把里面的user_id和post_id和isThumbed都取出来，如果user_id等于当前登录用户，则把这个post_id和isThumbed分别作为键值对加入到一个哈希表里。之后在查询首页帖子的时候，让对应的post_id去查这个哈希表，查到isThumbed为True就高亮点赞，这样就会很快，O(1)级别的【我后端查数据库，做了索引，用b+树查，是O(logn)级别的】

# 流程

### 首先对于POST而言

1. 通过一个哈希表，当初始化和刷新时，调用接口，获取点赞列表并存入哈希表。
2. 首页获取帖子列表后，通过哈希表判断，来进行页面渲染
3. 用户交互阶段，先计算next状态，进行乐观更新，立即更新本地哈希表，切换图标，异步调用 POST /thumb提交真实状态

### 对于commit也是类似的

1. 获取整个评论列表，通过判断进行渲染
2. 同上

# 技术细节

1. 利用pinia来进行全局状态管理，新建了user库来存储用户的点赞记录。
2. 在初始化和刷新阶段应该使用并行加载，实现同时拉取点赞表和帖子/评论表，加快速度
3. 利用watch来监听post.like的变化，实现实时更新

# 踩坑

1. 当并行执行加载和调用接口时，任何一个抛出异常都会导致Promise.all 整体失败，如果没有捕获，错误会向上冒泡
2. 利用computed而不是ref来建立响应式，store变化时自动重新计算
3. 应该创建本地副本LocalLikes，而不是直接修改pros
