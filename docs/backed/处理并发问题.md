可以按下面的小步骤来梳理和处理，并发上传被占满的问题：

- 梳理出口：确认 requestWithFiles 只返回一个带 abort/onProgressUpdate 的 Promise，内部失败时不要主动 abort。失败只负责 reject，把任务终结的控制权交给外面。
- 统一登记上传任务：在页面或 store 里创建 activeUploads 列表，发起上传时把返回的 Promise 保存进去（同时可保存原始的 uploadTask 引用），并在 Promise 完成或失败时删掉对应记录。
- 失败/异常后的清理动作：一旦捕获到上传失败（catch），或检测到错误码是 exceed max upload connection count 10，立刻遍历 activeUploads，对仍然存在的任务调用 abort()，然后清空列表。这样能主动释放小程序的上传连接。
- 启动新上传前的自检：在调用 apiCreateNewPost 之前，检查 activeUploads 是否为空。如果不为空，先执行一次“清理”流程（Abort + 清空），再重新发起上传；或者提示用户等待。
- 调试与验证：在控制台输出 activeUploads 的长度和任务状态，配合微信开发者工具 Network 面板，确认每次上传结束后连接数确实下降；确保页面卸载时也调用一次清空逻辑，防止旧页面遗留任务。
  通过“外部统一管理 + 失败后集中收尾”，就能避免失败任务一直占着并发，防止再触发“超过 10 个连接”这个限制。

# 莫名其妙好了
